# Mermaid 块组件

## 功能特性

### 内置工具栏
我们使用 BlockNote 风格的内置工具栏，提供了更加一致的用户体验：

- **下拉菜单式工具栏**：点击右上角的 "Mermaid" 按钮展开操作菜单
- **悬停显示**：鼠标悬停在块上时显示工具栏按钮
- **操作选项**：
  - 📝 编辑代码 - 打开代码编辑器
  - 📋 复制代码 - 复制 Mermaid 源代码到剪贴板
  - 🗑️ 删除图表 - 删除当前 Mermaid 块

### 编辑器特性

- **全屏编辑对话框**：居中显示，带有半透明背景
- **语法高亮**：使用等宽字体显示代码
- **实时预览**：保存后立即渲染图表
- **错误处理**：语法错误时显示友好的错误提示
- **深色模式支持**：自动适配深色主题

### 支持的图表类型

```mermaid
graph TD
    A[流程图] --> B[时序图]
    B --> C[甘特图]
    C --> D[类图]
    D --> E[状态图]
    E --> F[ER 图]
    F --> G[用户旅程图]
    G --> H[Git 图]
```

## 使用方法

### 1. 插入 Mermaid 块

在编辑器中输入 `/` 触发 Slash 菜单，然后选择 "Mermaid Diagram" 或输入 `mermaid`、`diagram`、`chart` 等关键词。

### 2. 编辑图表

点击右上角的 "Mermaid" 按钮，然后选择 "编辑代码" 打开编辑器。

### 3. 示例代码

#### 流程图
```mermaid
flowchart LR
    A[开始] --> B{是否登录?}
    B -->|是| C[显示主页]
    B -->|否| D[跳转登录页]
    D --> E[输入账号密码]
    E --> F[验证]
    F -->|成功| C
    F -->|失败| D
```

#### 时序图
```mermaid
sequenceDiagram
    participant U as 用户
    participant C as 客户端
    participant S as 服务器
    participant D as 数据库

    U->>C: 发起请求
    C->>S: HTTP 请求
    S->>D: 查询数据
    D-->>S: 返回结果
    S-->>C: HTTP 响应
    C-->>U: 显示结果
```

#### 甘特图
```mermaid
gantt
    title 项目开发计划
    dateFormat  YYYY-MM-DD
    section 设计
    需求分析           :done,    des1, 2024-01-01,2024-01-07
    UI 设计            :active,  des2, 2024-01-08, 7d
    数据库设计         :         des3, after des2, 5d
    section 开发
    后端开发           :         dev1, after des3, 15d
    前端开发           :         dev2, after des3, 12d
    section 测试
    单元测试           :         test1, after dev1, 5d
    集成测试           :         test2, after test1, 5d
```

## 技术实现

### 架构设计

1. **组件分离**：将渲染逻辑从块定义中分离，提高可维护性
2. **状态管理**：使用 React Hooks 管理编辑状态和渲染状态
3. **防抖渲染**：避免频繁渲染，提高性能
4. **错误边界**：优雅处理渲染错误，避免崩溃

### 样式系统

- 使用 Tailwind CSS 实现响应式设计
- 支持深色模式自动切换
- 自定义 Mermaid 主题配色

### 交互优化

- 键盘快捷键支持（ESC 关闭编辑器）
- 点击外部区域关闭下拉菜单
- 动画过渡效果提升体验

## 注意事项

1. **性能考虑**：大型图表可能影响渲染性能，建议适度控制图表复杂度
2. **浏览器兼容性**：需要现代浏览器支持 SVG 渲染
3. **导出限制**：导出的 SVG 文件可能需要额外的样式处理才能在其他应用中正确显示

## 后续优化

- [ ] 添加图表模板库
- [ ] 支持实时协同编辑
- [ ] 添加更多导出格式（PNG、PDF）
- [ ] 集成 AI 辅助生成图表
- [ ] 支持自定义主题配色
